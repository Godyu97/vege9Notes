1. Redis事务
   1. redis事务是一个单独的隔离操作，事物中所有的命令都会按顺序执行。事务执行过程中，不会被其他客户端发送的命令请求打断。redis事务的主要作用是串联多个命令防止别的命令插队。
   2. 命令
      * `multi`：开启事务，进入组队阶段
      * `exec`：执行阶段，将之前的命令队列依次执行
      * `discard`：放弃命令队伍，结束事务
      * `watch k1...`：执行multi前可以监视一或多个key，如果事务执行之前k被其他命令改动，那么事务将被打断
      * `unwatch`：取消watch命令对所有key的监视，如果watch后exec或discard先被执行的话，不需要再执行unwatch
   3. 事务的错误处理：组队阶段某个命令error，执行时整个命令队伍被discard；执行阶段某个命令error，不影响其他命令执行
2. 锁：处理data race
   1. 悲观锁：传统关系型数据库，行锁、表锁、读锁、写锁；操作前先上锁
   2. 乐观锁：redis，使用版本号机制(原子操作)，适用于多读情景，提高吞吐量。
   3. [悲观锁和乐观锁的原理及使用场景 - 简书 (jianshu.com)](https://www.jianshu.com/p/232a86cbd4b0)
3. Redis事务三特性
   1. 单独的隔离操作：事物中所有的命令都会按顺序执行。事务执行过程中，不会被其他客户端发送的命令请求打断
   2. 没有隔离级别的概念：命令队列未被提交前任何指令都不会被实际执行
   3. 不保证原子性：事物中如果有一条命令执行失败，其他命令热然执行，不会回滚
4. 秒杀案例
   1. 连接超时问题：连接池
   2. 超卖问题：乐观锁，事务multi
   3. 库存遗留问题：事物中乐观锁版本号改变造成的事务执行失败；lua脚本调用redis，多操作原子操作(类似于悲观锁)