1. RDB
   1. redis database ：在指定的时间间隔，将内存中的数据快照Snapshot写入磁盘；恢复时是将快照文件直接读到内存中
   1. redis默认开启RDB持久化，dump.rdb
   2. 过程：
      * redis单独fork创建子进程来进行持久化
      * 先将数据写入到临时文件
      * 持久化结束用这个临时文件替换上次持久化的文件dump.rdb
   3. Fork：复制一个与当前进程一样的进程，作为原进程的子进程；写时复制技术；父进程和子进程共用同一段物理内存
   4. 命令：
      * `save`：手动阻塞，进行快照
      * `bgsave`：异步快照
      * `lastsave`：获取上次快照的时间
   5. 优点：主进程不进行IO操作，性能高，节省磁盘；适合大规模数据恢复
   6. 缺点：
      * 最后一次持久化后的数据可能丢失，数据完整性和一致性要求不高
      * 内存中数据被拷贝一份，2倍膨胀性
   7. 执行`flushall`后会产生空的dump.rdb
2. AOF
   1. append only file：以日志形式记录每个写操作(增量保存)，读操作不记录，只追加文件但不能改写文件。redis重启时会读取日志重建数据，将所有写指令重新执行完成数据恢复。
   2. redis默认不开启AOF持久化，appendonly.aof
   3. 异常恢复：`redis-check-aof --fix appendonly.aof`
   4. 同步频率设置：`appendfsync always(每个写操作)/everysec(每秒)/no(操作系统同步)`
   5. Rewrite压缩：压缩指令，保存可以恢复数据的最小指令集`bgrewriteaof`
   6. 过程：
      * 客户端请求的写指令被append到aof缓冲区内
      * aof缓冲区根据AOF持久化频率策略将指令同步到磁盘aof文件中
      * aof文件大小超过阀值或手动重写时，fork子进程(不阻塞主进程)对aof文件rewrite重写压缩
   7. 优点：备份机制稳定，丢失数据概率低；可读的aof文件
   8. 缺点：占用更多磁盘空间；恢复速度慢；写同步有一定性能压力
3. AOF和RDB同时开启，redis默认取AOF的数据
4. 官方推荐两个持久化方式都启用